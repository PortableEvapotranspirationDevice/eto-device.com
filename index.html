<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Evapotranspiration System</title>
  <style>
    body {
      background-color: #2C2C2C;
      font-family: 'Comic Sans MS', sans-serif;
      margin: 0;
      padding: 0;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      text-align: center;
      border: 2px solid white;
      padding: 20px;
      width: 90%;
      max-width: 600px;
    }

    .heading {
      font-size: 30px;
      font-weight: bold;
      margin-bottom: 30px;
      border: 2px solid white;
      padding: 10px;
      display: inline-block;
    }

    .eto-title {
      background-color: #A05A2C;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      border: 2px solid white;
    }

    .eto-title h2 {
      font-size: 20px;
      margin: 0;
    }

    .eto-value {
      background-color: #A05A2C;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      border: 2px solid white;
    }

    .eto-value p {
      font-size: 24px;
      font-weight: bold;
      margin: 0;
    }

    .section-header {
      font-size: 20px;
      margin-top: 20px;
      margin-bottom: 10px;
      padding: 10px;
      background-color: #1B4D67;
      border: 2px solid white;
      border-radius: 5px;
    }

    .sensor-container {
      display: flex;
      justify-content: space-between;
      width: 100%;
      margin-top: 10px;
    }

    .sensor-box {
      background-color: #2C2C2C;
      padding: 20px;
      border-radius: 5px;
      text-align: center;
      border: 2px solid white;
      flex: 1;
      margin: 0 10px;
    }

    .sensor-box h2 {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .sensor-box p {
      font-size: 24px;
      font-weight: bold;
    }

    .rs-value-box {
      background-color: #2C2C2C;
      padding: 20px;
      border-radius: 5px;
      text-align: center;
      border: 2px solid white;
      margin-top: 10px;
    }

    .rs-value-box h2 {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .rs-value-box p {
      font-size: 24px;
      font-weight: bold;
      margin: 0;
    }

    @media (max-width: 500px) {
      .sensor-container {
        flex-direction: column;
        align-items: center;
      }
      .sensor-box {
        margin-bottom: 10px;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="heading">IoT-BASED PORTABLE EVAPOTRANSPIRATION SYSTEM</div>

    <div class="eto-title">
      <h2>EVAPOTRANSPIRATION MEASUREMENT (ETo)</h2>
    </div>

    <div class="eto-value">
      <p id="eto">-- mm/day</p>
    </div>

    <div class="section-header">DHT SENSOR REALTIME READINGS</div>

    <div class="sensor-container">
      <div class="sensor-box">
        <h2>Temperature</h2>
        <p id="temperature">-- &#8451;</p>
      </div>
      <div class="sensor-box">
        <h2>Humidity</h2>
        <p id="humidity">--%</p>
      </div>
    </div>

    <div class="section-header">SOLAR RADIATION VALUE (MJ/mÂ²/day)</div>

    <div class="rs-value-box">
      <p id="rs">--</p>
    </div>
  </div>

  <!-- Firebase scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCufdu4avr1VDm_vVqN0Rx5uOUAcArUp3Y",
      authDomain: "thesiseto.firebaseapp.com",
      databaseURL: "https://thesiseto-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "thesiseto",
      storageBucket: "thesiseto.appspot.com",
      messagingSenderId: "986260488204",
      appId: "1:986260488204:web:7e58f5faf4bcf9becb6e29"
    };

    firebase.initializeApp(firebaseConfig);

    const database = firebase.database();
    const dataRef1 = database.ref('DHT_11/Humidity');
    const dataRef2 = database.ref('DHT_11/Temperature');

    let Tmax = -Infinity, Tmin = Infinity;

    const dailyRsValues = {
      "May-24": 38.35651, "May-25": 38.34594, "May-26": 38.33519, "May-27": 38.3243,
      "May-28": 38.31331, "May-29": 38.30225, "May-30": 38.29116, "May-31": 38.28007,
      "Jun-01": 38.26902, "Jun-02": 38.25803, "Jun-03": 38.24714, "Jun-04": 38.23638,
      "Jun-05": 38.22578, "Jun-06": 38.21536, "Jun-07": 38.20515, "Jun-08": 38.19517,
      "Jun-09": 38.18546, "Jun-10": 38.17601, "Jun-11": 38.16687, "Jun-12": 38.15805,
      "Jun-13": 38.14955, "Jun-14": 38.14141, "Jun-15": 38.13363, "Jun-16": 38.12623,
      "Jun-17": 38.11921, "Jun-18": 38.11258, "Jun-19": 38.10636, "Jun-20": 38.10054,
      "Jun-21": 38.09015, "Jun-22": 38.09015, "Jun-23": 38.08557, "Jun-24": 38.08141
    };

    function getTodayKey() {
      const now = new Date();
      const month = now.toLocaleString('default', { month: 'short' });
      const day = now.getDate().toString().padStart(2, '0');
      return `${month}-${day}`;
    }

    function calculateETo() {
      const RH = parseFloat(document.getElementById('humidity').innerHTML) || 0;
      const Tmean = (Tmax + Tmin) / 2 || 0;
      const latRad = 14.19775 * (Math.PI / 180); // Latitude in radians

      const todayKey = getTodayKey();
      const Rs = dailyRsValues[todayKey] || 38.44009;

      // Update Rs display
      document.getElementById('rs').textContent = Rs.toFixed(5);

      const term1 = 0.0393 * Rs * Math.sqrt(Tmean + 9.5);
      const term2 = 0.19 * Math.pow(Rs, 0.6) * Math.pow(latRad, 0.15);
      const term3 = 0.078 * (Tmean + 20) * (1 - RH / 100);

      const ETo = term1 - term2 + term3;

      document.getElementById('eto').innerHTML = ETo.toFixed(2) + " mm/day";
    }

    dataRef1.on('value', function(snapshot) {
      const humi = snapshot.val();
      document.getElementById('humidity').innerHTML = humi + "%";
      calculateETo();
    });

    dataRef2.on('value', function(snapshot) {
      const temp = snapshot.val();
      document.getElementById('temperature').innerHTML = temp + "&#8451;";
      Tmax = Math.max(Tmax, temp);
      Tmin = Math.min(Tmin, temp);
      calculateETo();
    });
  </script>
</body>
</html>
